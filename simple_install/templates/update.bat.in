@echo off

PUSHD "%~dp0"
call .venv\Scripts\activate.bat

echo This script will update InvokeAI and all its dependencies. If you do not want to do this, press control-C now!
pause

set INVOKE_AI_SRC=https://github.com/invoke-ai/InvokeAI/archive/main.zip

call pip install -r requirements.txt
if %errorlevel% neq 0 (
   echo Installation of requirements failed. See https://invoke-ai.github.io/InvokeAI/installation/INSTALL_AUTOMATED/#troubleshooting for suggestions.
   exit /b
)

call pip install %INVOKE_AI_SRC%
if %errorlevel% neq 0 (
   echo Installation of InvokeAI failed. See https://invoke-ai.github.io/InvokeAI/installation/INSTALL_AUTOMATED/#troubleshooting for suggestions.
   exit /b
)

call .venv\Scripts\python .venv\Scripts\configure_invokeai.py --root="%rootdir%"

if %errorlevel% neq 0 (
   echo Configuration InvokeAI failed. See https://invoke-ai.github.io/InvokeAI/installation/INSTALL_AUTOMATED/#troubleshooting for suggestions.
   exit /b
)

echo "Press any key to continue"
pause
exit 0

